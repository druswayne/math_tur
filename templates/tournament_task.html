{% extends "base.html" %}

{% block content %}
<!-- Оверлей загрузки -->
<div id="loadingOverlay" class="loading-overlay">
    <div class="loading-spinner">
        <div class="spinner-border" role="status">
            <span class="visually-hidden">Загрузка...</span>
        </div>
        <p class="mt-3">Загрузка задачи...</p>
        <p class="text-light small">Пожалуйста, не закрывайте страницу</p>
    </div>
</div>

<!-- Оверлей нарушения -->
<div id="violationOverlay" class="loading-overlay" style="display:none; z-index: 9999;">
    <div class="loading-spinner">
        <div class="spinner-border" role="status">
            <span class="visually-hidden">Нарушение...</span>
        </div>
        <p class="mt-3 text-danger" style="font-size:1.3rem; font-weight:600;">Нарушение зафиксировано. Ожидайте</p>
    </div>
</div>

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <!-- Таймер турнира -->
            <div class="card mb-4">
                <div class="card-body text-center">
                    <h4 class="card-title mb-3">До окончания турнира осталось:</h4>
                    <div class="countdown-timer">
                        <div class="countdown-items">
                            <div class="countdown-item">
                                <div class="countdown-number" id="hours">00</div>
                                <div class="countdown-label">часов</div>
                            </div>
                            <div class="countdown-item">
                                <div class="countdown-number" id="minutes">00</div>
                                <div class="countdown-label">минут</div>
                            </div>
                            <div class="countdown-item">
                                <div class="countdown-number" id="seconds">00</div>
                                <div class="countdown-label">секунд</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Задача -->
            <div class="card">
                <div class="card-body">
                    <h2 class="card-title text-center mb-4">{{ tournament.title }}</h2>
                    
                    <div class="task-content">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h4 class="mb-0 no-select">{{ task.title }}</h4>
                            <span class="badge bg-primary fs-5">{{ task.points }} баллов</span>
                        </div>
                        <p class="mb-4 no-select">{{ task.description }}</p>
                        
                        {% if task.image %}
                        <div class="text-center mb-4">
                            <img src="https://s3.twcstorage.ru/5e984fdc-c435406b-ee7b-4296-aaed-0ceae9456f42/tasks/{{ task.image }}" 
                                 class="img-fluid task-image" 
                                 alt="Изображение к задаче"
                                 data-bs-toggle="modal" 
                                 data-bs-target="#imageModal"
                                 style="cursor: pointer; max-height: 400px; object-fit: contain;">
                            <div class="mt-2">
                                <small class="text-muted">
                                    <i class="fas fa-search-plus me-1"></i>Нажмите на изображение для увеличения
                                </small>
                            </div>
                        </div>
                        {% endif %}
                        
                        <form id="answerForm" action="{{ url_for('submit_task_answer', tournament_id=tournament.id, task_id=task.id) }}" 
                              method="POST" 
                              class="mt-4">
                            <div class="mb-3">
                                <label for="answer" class="form-label">Ваш ответ:</label>
                                <input type="text" 
                                       class="form-control" 
                                       id="answer" 
                                       name="answer" 
                                       required 
                                       autocomplete="off">
                            </div>
                            <div class="text-center">
                                <button type="button" class="btn btn-primary btn-lg" id="submitBtn">
                                    Отправить ответ
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Модальное окно подтверждения -->
<div class="modal fade" id="confirmModal" tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmModalLabel">Подтверждение отправки</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Вы уверены, что хотите отправить ответ?</p>
                <p class="mb-0">Ваш ответ: <strong id="answerPreview"></strong></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
                <button type="button" class="btn btn-primary" id="confirmSubmit">Отправить</button>
            </div>
        </div>
    </div>
</div>

<!-- Модальное окно для просмотра изображения -->
<div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="imageModalLabel">Изображение к задаче</h5>
                <div class="zoom-controls">
                    <button type="button" class="btn btn-sm btn-outline-secondary" id="zoomIn">
                        <i class="fas fa-search-plus"></i>
                    </button>
                    <button type="button" class="btn btn-sm btn-outline-secondary" id="zoomOut">
                        <i class="fas fa-search-minus"></i>
                    </button>
                    <button type="button" class="btn btn-sm btn-outline-secondary" id="resetZoom">
                        <i class="fas fa-expand-arrows-alt"></i>
                    </button>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center p-0">
                <div class="image-container" id="imageContainer">
                    <img src="https://s3.twcstorage.ru/5e984fdc-c435406b-ee7b-4296-aaed-0ceae9456f42/tasks/{{ task.image }}" 
                         class="zoomable-image" 
                         alt="Изображение к задаче"
                         id="zoomableImage">
                </div>
            </div>
            <div class="modal-footer">
                <div class="zoom-info">
                    <small class="text-muted">
                        <span id="zoomLevel">100%</span> | 
                        <span id="zoomHint">Используйте колесико мыши для зума, зажмите левую кнопку для перемещения</span>
                    </small>
                </div>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Закрыть</button>
            </div>
        </div>
    </div>
</div>

<style>

/* Стили для защиты от копирования */
.no-select {
    user-select: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    pointer-events: none;
}

/* Стили для изображения задачи */
.task-image {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    border-radius: 8px;
    border: 2px solid #e9ecef;
}

.task-image:hover {
    transform: scale(1.02);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    border-color: #007bff;
}

/* Стили для модального окна изображения */
#imageModal .modal-dialog {
    max-width: 90vw;
}

#imageModal .modal-body {
    background-color: #f8f9fa;
    overflow: hidden;
    position: relative;
}

#imageModal img {
    border-radius: 8px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
}

/* Стили для зума изображения */
.image-container {
    width: 100%;
    height: 70vh;
    overflow: hidden;
    position: relative;
    background-color: #f8f9fa;
    border-radius: 8px;
}

.zoomable-image {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
    transition: transform 0.1s ease;
    cursor: grab;
    user-select: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(1);
}

.zoomable-image:active {
    cursor: grabbing;
}

.zoomable-image.zoomed {
    cursor: grab;
}

/* Контролы зума */
.zoom-controls {
    display: flex;
    gap: 5px;
    align-items: center;
}

.zoom-controls .btn {
    padding: 4px 8px;
    font-size: 12px;
}

.zoom-info {
    flex-grow: 1;
    text-align: left;
}

/* Мобильные стили */
@media (max-width: 768px) {
    .image-container {
        height: 60vh;
    }
    
    .zoom-controls {
        gap: 3px;
    }
    
    .zoom-controls .btn {
        padding: 3px 6px;
        font-size: 11px;
    }
    
    #zoomHint {
        display: none;
    }
}

.task-content {
    position: relative;
}

/* Добавляем предупреждение при попытке копирования */
.task-content::after {
    content: "Копирование текста запрещено";
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: rgba(0, 0, 0, 0.8);
    color: white;
    padding: 10px 20px;
    border-radius: 5px;
    display: none;
    z-index: 1000;
}

/* Стили для предупреждения о потере фокуса */
.warning-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 9999;
}

.warning-content {
    background-color: white;
    padding: 20px;
    border-radius: 8px;
    text-align: center;
    max-width: 400px;
}

.warning-content h3 {
    color: #dc3545;
    margin-bottom: 15px;
}

.warning-content p {
    margin-bottom: 20px;
}

.warning-content .countdown {
    font-size: 1.2em;
    font-weight: bold;
    color: #dc3545;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Скрываем оверлей после полной загрузки страницы
    const loadingOverlay = document.getElementById('loadingOverlay');
    if (loadingOverlay) {
        loadingOverlay.style.opacity = '0';
        setTimeout(() => {
            loadingOverlay.style.display = 'none';
        }, 300);
    }

    let serverTimeOffset = 0; // Смещение между серверным и клиентским временем
    let isSubmitting = false;
    let isLeaving = false;
    
    // Инициализация модального окна
    const confirmModal = new bootstrap.Modal(document.getElementById('confirmModal'));
    const answerInput = document.getElementById('answer');
    const answerPreview = document.getElementById('answerPreview');
    const submitBtn = document.getElementById('submitBtn');
    const confirmSubmitBtn = document.getElementById('confirmSubmit');
    const answerForm = document.getElementById('answerForm');
    
    // Предотвращаем отправку формы по нажатию Enter
    answerInput.addEventListener('keydown', function(e) {
        if (e.key === 'Enter') {
            e.preventDefault();
            return false;
        }
    });
    
    // Обработчик нажатия на кнопку отправки
    submitBtn.addEventListener('click', function() {
        if (answerInput.value.trim() === '') {
            return;
        }
        answerPreview.textContent = answerInput.value;
        confirmModal.show();
    });
    
    // Обработчик отправки формы
    answerForm.addEventListener('submit', function(e) {
        e.preventDefault();
        // Показываем модальное окно подтверждения
        confirmModal.show();
    });
    
    // Обработчик подтверждения отправки
    confirmSubmitBtn.addEventListener('click', function() {
        isSubmitting = true;
        
        // Показываем оверлей загрузки
        const loadingOverlay = document.getElementById('loadingOverlay');
        if (loadingOverlay) {
            // Меняем текст в оверлее
            const loadingText = loadingOverlay.querySelector('p');
            if (loadingText) {
                loadingText.textContent = 'Отправка ответа...';
                // Добавляем дополнительный текст
                const warningText = document.createElement('p');
                warningText.className = 'text-light small mt-2';
                //warningText.textContent = 'Пожалуйста, не закрывайте страницу';
                loadingText.parentNode.appendChild(warningText);
            }
            
            loadingOverlay.style.display = 'flex';
            setTimeout(() => {
                loadingOverlay.style.opacity = '1';
                // Отправляем форму
                answerForm.submit();
            }, 200);
        } else {
            answerForm.submit();
        }
    });
    
    // Создаем оверлей для предупреждения
    const warningOverlay = document.createElement('div');
    warningOverlay.className = 'warning-overlay';
    warningOverlay.innerHTML = `
        <div class="warning-content">
            <h3>Внимание!</h3>
            <p>Вы покинули страницу с задачей. Вернитесь на страницу в течение <span class="countdown">5</span> секунд, иначе задача будет засчитана как нерешенная.</p>
        </div>
    `;
    document.body.appendChild(warningOverlay);
    
    function getServerTime() {
        const clientNow = new Date();
        return new Date(clientNow.getTime() + serverTimeOffset);
    }

    function updateTimer() {
        const startDate = new Date("{{ tournament.start_date.isoformat() }}");
        const tournamentDuration = {{ tournament.duration }}; // длительность в минутах
        const serverNow = getServerTime();
        
        // Вычисляем время окончания турнира
        const endTime = new Date(startDate.getTime() + tournamentDuration * 60000);
        const timeLeft = endTime - serverNow;
        
        if (timeLeft <= 0) {
            // Если время вышло, перенаправляем на страницу результатов
            window.location.href = "{{ url_for('tournament_results', tournament_id=tournament.id) }}";
            return;
        }
        
        // Вычисляем оставшееся время
        const hours = Math.floor(timeLeft / (1000 * 60 * 60));
        const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
        
        // Обновляем отображение
        document.getElementById('hours').textContent = hours.toString().padStart(2, '0');
        document.getElementById('minutes').textContent = minutes.toString().padStart(2, '0');
        document.getElementById('seconds').textContent = seconds.toString().padStart(2, '0');
    }
    
    // Инициализация смещения времени при загрузке страницы
    const serverNow = new Date("{{ now.isoformat() }}");
    const clientNow = new Date();
    serverTimeOffset = serverNow.getTime() - clientNow.getTime();
    
    // Обновляем таймер каждую секунду
    updateTimer();
    setInterval(updateTimer, 1000);

    // Защита от копирования
    const taskContent = document.querySelector('.task-content');
    const warning = document.createElement('div');
    warning.className = 'copy-warning';
    warning.textContent = 'Копирование текста запрещено';
    document.body.appendChild(warning);

    // Предотвращаем контекстное меню
    taskContent.addEventListener('contextmenu', function(e) {
        e.preventDefault();
        showWarning();
    });

    // Предотвращаем выделение текста
    taskContent.addEventListener('selectstart', function(e) {
        e.preventDefault();
        showWarning();
    });

    // Предотвращаем копирование
    taskContent.addEventListener('copy', function(e) {
        e.preventDefault();
        showWarning();
    });

    function showWarning() {
        warning.style.display = 'block';
        setTimeout(() => {
            warning.style.display = 'none';
        }, 2000);
    }

    // Обработка потери фокуса
    let warningTimeout;
    let countdownInterval;
    let countdown = 5;

    function startCountdown() {
        const countdownElement = warningOverlay.querySelector('.countdown');
        countdown = 5;
        countdownElement.textContent = countdown;
        
        countdownInterval = setInterval(() => {
            countdown--;
            countdownElement.textContent = countdown;
            
            if (countdown <= 0) {
                clearInterval(countdownInterval);
                submitWrongAnswer();
            }
        }, 1000);
    }

    function showViolationOverlay() {
        const overlay = document.getElementById('violationOverlay');
        if (overlay) {
            overlay.style.display = 'flex';
            overlay.style.opacity = '1';
        }
    }

    function submitWrongAnswer() {
        if (!isSubmitting && !isLeaving) {
            isSubmitting = true;
            showViolationOverlay();
            const input = document.getElementById('answer');
            input.value = 'wrong_answer_due_to_tab_switch';
            answerForm.submit();
        }
    }

    // Обработчики событий видимости страницы
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            warningOverlay.style.display = 'flex';
            startCountdown();
        } else {
            warningOverlay.style.display = 'none';
            clearInterval(countdownInterval);
        }
    });

    // Обработчик потери фокуса окна
    window.addEventListener('blur', function() {
        warningOverlay.style.display = 'flex';
        startCountdown();
    });

    // Обработчик получения фокуса окна
    window.addEventListener('focus', function() {
        warningOverlay.style.display = 'none';
        clearInterval(countdownInterval);
    });

    // Обработчик выхода со страницы
    window.addEventListener('beforeunload', function(e) {
        if (!isSubmitting && !isLeaving) {
            isLeaving = true;
            // Отправляем неверный ответ перед уходом
            const input = document.getElementById('answer');
            input.value = 'wrong_answer_due_to_page_leave';
            
            // Используем sendBeacon для гарантированной отправки данных
            const formData = new FormData(answerForm);
            navigator.sendBeacon(answerForm.action, formData);
            
            // Показываем стандартное предупреждение браузера
            e.preventDefault();
            e.returnValue = 'Отправить ответ на задачу?';
            return 'Отправить ответ на задачу?';
        }
    });

    // Обработчик клика по ссылкам
    document.addEventListener('click', function(e) {
        if (e.target.tagName === 'A' && !e.target.classList.contains('btn')) {
            if (!isSubmitting && !isLeaving) {
                isLeaving = true;
                const input = document.getElementById('answer');
                input.value = 'wrong_answer_due_to_page_leave';
                
                // Используем sendBeacon для гарантированной отправки данных
                const formData = new FormData(answerForm);
                navigator.sendBeacon(answerForm.action, formData);
            }
        }
    });

    // Обработка модального окна изображения с зумом
    const imageModal = document.getElementById('imageModal');
    if (imageModal) {
        const imageContainer = document.getElementById('imageContainer');
        const zoomableImage = document.getElementById('zoomableImage');
        const zoomInBtn = document.getElementById('zoomIn');
        const zoomOutBtn = document.getElementById('zoomOut');
        const resetZoomBtn = document.getElementById('resetZoom');
        const zoomLevel = document.getElementById('zoomLevel');
        
        let currentZoom = 1;
        let isDragging = false;
        let startX = 0;
        let startY = 0;
        let translateX = 0;
        let translateY = 0;
        
        // Функция обновления трансформации
        function updateTransform() {
            zoomableImage.style.transform = `translate(calc(-50% + ${translateX}px), calc(-50% + ${translateY}px)) scale(${currentZoom})`;
            zoomLevel.textContent = Math.round(currentZoom * 100) + '%';
        }
        
        // Функция сброса зума
        function resetZoom() {
            currentZoom = 1;
            translateX = 0;
            translateY = 0;
            constrainTranslation();
            updateTransform();
            zoomableImage.classList.remove('zoomed');
        }
        
        // Функция зума
        function zoom(delta, x, y) {
            const oldZoom = currentZoom;
            currentZoom = Math.max(0.5, Math.min(5, currentZoom + delta));
            
            if (currentZoom !== oldZoom) {
                // Центрируем зум на позиции курсора
                const rect = imageContainer.getBoundingClientRect();
                const mouseX = x - rect.left;
                const mouseY = y - rect.top;
                
                const zoomRatio = currentZoom / oldZoom;
                translateX = mouseX - (mouseX - translateX) * zoomRatio;
                translateY = mouseY - (mouseY - translateY) * zoomRatio;
                
                // Ограничиваем перемещение, чтобы изображение не уходило за границы
                constrainTranslation();
                
                updateTransform();
                
                if (currentZoom > 1) {
                    zoomableImage.classList.add('zoomed');
                } else {
                    zoomableImage.classList.remove('zoomed');
                }
            }
        }
        
        // Функция ограничения перемещения
        function constrainTranslation() {
            const rect = imageContainer.getBoundingClientRect();
            const imgRect = zoomableImage.getBoundingClientRect();
            
            // Вычисляем границы для перемещения
            const maxTranslateX = Math.max(0, (imgRect.width * currentZoom - rect.width) / 2);
            const maxTranslateY = Math.max(0, (imgRect.height * currentZoom - rect.height) / 2);
            
            // Ограничиваем перемещение
            translateX = Math.max(-maxTranslateX, Math.min(maxTranslateX, translateX));
            translateY = Math.max(-maxTranslateY, Math.min(maxTranslateY, translateY));
        }
        
        // Обработчик колесика мыши
        imageContainer.addEventListener('wheel', function(e) {
            e.preventDefault();
            const delta = e.deltaY > 0 ? -0.1 : 0.1;
            zoom(delta, e.clientX, e.clientY);
        });
        
        // Обработчики кнопок зума
        zoomInBtn.addEventListener('click', function() {
            const rect = imageContainer.getBoundingClientRect();
            zoom(0.2, rect.left + rect.width / 2, rect.top + rect.height / 2);
        });
        
        zoomOutBtn.addEventListener('click', function() {
            const rect = imageContainer.getBoundingClientRect();
            zoom(-0.2, rect.left + rect.width / 2, rect.top + rect.height / 2);
        });
        
        resetZoomBtn.addEventListener('click', resetZoom);
        
        // Обработчики перетаскивания (десктоп)
        zoomableImage.addEventListener('mousedown', function(e) {
            if (currentZoom > 1) {
                isDragging = true;
                startX = e.clientX - translateX;
                startY = e.clientY - translateY;
                zoomableImage.style.cursor = 'grabbing';
                e.preventDefault();
            }
        });
        
        document.addEventListener('mousemove', function(e) {
            if (isDragging) {
                translateX = e.clientX - startX;
                translateY = e.clientY - startY;
                constrainTranslation();
                updateTransform();
            }
        });
        
        document.addEventListener('mouseup', function() {
            if (isDragging) {
                isDragging = false;
                zoomableImage.style.cursor = 'grab';
            }
        });
        
        // Обработчики для мобильных устройств
        let initialDistance = 0;
        let initialZoom = 1;
        let initialTranslateX = 0;
        let initialTranslateY = 0;
        let lastTouchX = 0;
        let lastTouchY = 0;
        
        // Обработчик касания для зума
        imageContainer.addEventListener('touchstart', function(e) {
            if (e.touches.length === 2) {
                // Два пальца - зум
                const touch1 = e.touches[0];
                const touch2 = e.touches[1];
                initialDistance = Math.sqrt(
                    Math.pow(touch2.clientX - touch1.clientX, 2) +
                    Math.pow(touch2.clientY - touch1.clientY, 2)
                );
                initialZoom = currentZoom;
                initialTranslateX = translateX;
                initialTranslateY = translateY;
            } else if (e.touches.length === 1) {
                // Один палец - перемещение
                const touch = e.touches[0];
                lastTouchX = touch.clientX;
                lastTouchY = touch.clientY;
            }
        });
        
        imageContainer.addEventListener('touchmove', function(e) {
            e.preventDefault();
            
            if (e.touches.length === 2) {
                // Зум двумя пальцами
                const touch1 = e.touches[0];
                const touch2 = e.touches[1];
                const distance = Math.sqrt(
                    Math.pow(touch2.clientX - touch1.clientX, 2) +
                    Math.pow(touch2.clientY - touch1.clientY, 2)
                );
                
                const zoomDelta = (distance - initialDistance) / 100;
                currentZoom = Math.max(0.5, Math.min(5, initialZoom + zoomDelta));
                
                // Центрируем зум
                const centerX = (touch1.clientX + touch2.clientX) / 2;
                const centerY = (touch1.clientY + touch2.clientY) / 2;
                const rect = imageContainer.getBoundingClientRect();
                const mouseX = centerX - rect.left;
                const mouseY = centerY - rect.top;
                
                const zoomRatio = currentZoom / initialZoom;
                translateX = mouseX - (mouseX - initialTranslateX) * zoomRatio;
                translateY = mouseY - (mouseY - initialTranslateY) * zoomRatio;
                
                constrainTranslation();
                updateTransform();
                
                if (currentZoom > 1) {
                    zoomableImage.classList.add('zoomed');
                } else {
                    zoomableImage.classList.remove('zoomed');
                }
            } else if (e.touches.length === 1 && currentZoom > 1) {
                // Перемещение одним пальцем
                const touch = e.touches[0];
                const deltaX = touch.clientX - lastTouchX;
                const deltaY = touch.clientY - lastTouchY;
                
                translateX += deltaX;
                translateY += deltaY;
                
                constrainTranslation();
                
                lastTouchX = touch.clientX;
                lastTouchY = touch.clientY;
                
                updateTransform();
            }
        });
        
        imageContainer.addEventListener('touchend', function(e) {
            // Сброс состояния
        });
        
        // Двойной клик для сброса зума
        zoomableImage.addEventListener('dblclick', resetZoom);
        
        // Закрытие модального окна по клавише Escape
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const modal = bootstrap.Modal.getInstance(imageModal);
                if (modal && imageModal.classList.contains('show')) {
                    modal.hide();
                }
            }
        });
        
        // Сброс зума при открытии модального окна
        imageModal.addEventListener('shown.bs.modal', resetZoom);
    }
});
</script>
{% endblock %} 