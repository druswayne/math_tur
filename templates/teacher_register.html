{% extends "base.html" %}

{% block styles %}
<style>
/* –°—Ç–∏–ª–∏ –¥–ª—è –∫—É—Ä—Å–∏–≤–Ω—ã—Ö –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–æ–≤ */
.form-control::placeholder {
    font-style: italic;
    color: #6c757d;
    opacity: 0.8;
}

/* –î–ª—è —Ä–∞–∑–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤ */
.form-control::-webkit-input-placeholder {
    font-style: italic;
    color: #6c757d;
    opacity: 0.8;
}

.form-control::-moz-placeholder {
    font-style: italic;
    color: #6c757d;
    opacity: 0.8;
}

.form-control:-ms-input-placeholder {
    font-style: italic;
    color: #6c757d;
    opacity: 0.8;
}

.form-control:-moz-placeholder {
    font-style: italic;
    color: #6c757d;
    opacity: 0.8;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –º–µ—Ä—Ü–∞–Ω–∏—è –ø—É—Å—Ç—ã—Ö –ø–æ–ª–µ–π */
.form-control.empty-field {
    border-color: #ffecb3;
    border-width: 1px;
    box-shadow: 0 0 0 0.1rem rgba(255, 236, 179, 0.1);
    background-color: rgba(255, 236, 179, 0.02);
    animation: emptyFieldBlink 3s infinite;
}

.input-group-text.empty-field {
    border-color: #ffecb3;
    border-width: 1px;
    color: #a1887f;
    background-color: rgba(255, 236, 179, 0.04);
    font-weight: normal;
}

@keyframes emptyFieldBlink {
    0% {
        box-shadow: 0 0 0 0.1rem rgba(255, 236, 179, 0.1);
        border-color: #ffecb3;
    }
    50% {
        box-shadow: 0 0 0 0.15rem rgba(255, 236, 179, 0.15);
        border-color: #ffcc80;
    }
    100% {
        box-shadow: 0 0 0 0.1rem rgba(255, 236, 179, 0.1);
        border-color: #ffecb3;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h3 class="text-center">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—á–∏—Ç–µ–ª—è</h3>
                </div>
                <div class="card-body">
                    {% with messages = get_flashed_messages(with_categories=true) %}
                        {% if messages %}
                            {% for category, message in messages %}
                                <div class="alert alert-{{ category }}">{{ message }}</div>
                            {% endfor %}
                        {% endif %}
                    {% endwith %}
                    
                    <form method="POST" action="{{ url_for('teacher_register') }}" id="teacherRegisterForm">
                        <div class="mb-3">
                            <label for="username" class="form-label">–õ–æ–≥–∏–Ω <span class="text-danger">*</span></label>
                            <div class="input-group">
                            <input type="text" class="form-control" id="username" name="username" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä ivan2004" required>
                                <span class="input-group-text validation-icon" id="username-icon">
                                    <i class="fas fa-spinner fa-spin" style="display: none;"></i>
                                    <i class="fas fa-check-circle text-success" style="display: none;"></i>
                                    <i class="fas fa-times text-danger" style="display: none;"></i>
                                </span>
                                </div>
                            <div class="form-text">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã –ª–∞—Ç–∏–Ω—Å–∫–æ–≥–æ –∞–ª—Ñ–∞–≤–∏—Ç–∞ (a-z), —Ü–∏—Ñ—Ä—ã (0-9) –∏ –∑–Ω–∞–∫ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è _.</div>
                        </div>

                        <div class="mb-3">
                            <label for="password" class="form-label">–ü–∞—Ä–æ–ª—å <span class="text-danger">*</span></label>
                            <div class="input-group">
                            <input type="password" class="form-control" id="password" name="password" required>
                                <button type="button" class="btn btn-outline-secondary" id="togglePassword" title="–ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –ø–∞—Ä–æ–ª—å">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <span class="input-group-text validation-icon" id="password-icon">
                                    <i class="fas fa-check-circle text-success" style="display: none;"></i>
                                    <i class="fas fa-times text-danger" style="display: none;"></i>
                                </span>
                            </div>
                            <div class="password-requirements mt-2" id="password-requirements">
                                <small class="text-muted">–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø–∞—Ä–æ–ª—é:</small>
                                <ul class="list-unstyled mt-1 mb-0">
                                    <li id="req-length"><i class="fas fa-circle text-muted"></i> –ú–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤</li>
                                    <li id="req-uppercase"><i class="fas fa-circle text-muted"></i> –ó–∞–≥–ª–∞–≤–Ω–∞—è –±—É–∫–≤–∞: A,B,C...</li>
                                    <li id="req-lowercase"><i class="fas fa-circle text-muted"></i> –°—Ç—Ä–æ—á–Ω–∞—è –±—É–∫–≤–∞: a,b,c...</li>
                                    <li id="req-number"><i class="fas fa-circle text-muted"></i> –¶–∏—Ñ—Ä–∞: 0,1,2,3...</li>
                                    <li id="req-special"><i class="fas fa-circle text-muted"></i> –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å–∏–º–≤–æ–ª (!@#$%^&*()_+-=[]{}|;:,.<>?)</li>
                                </ul>
                                </div>
                        </div>

                        <div class="mb-3">
                            <label for="confirm_password" class="form-label">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å <span class="text-danger">*</span></label>
                            <div class="input-group">
                            <input type="password" class="form-control" id="confirm_password" name="confirm_password" required>
                                <button type="button" class="btn btn-outline-secondary" id="toggleConfirmPassword" title="–ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –ø–∞—Ä–æ–ª—å">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <span class="input-group-text validation-icon" id="confirm_password-icon">
                                    <i class="fas fa-check-circle text-success" style="display: none;"></i>
                                    <i class="fas fa-times text-danger" style="display: none;"></i>
                                </span>
                                </div>
                        </div>

                        <hr class="my-4" style="border: 2px solid grey; border-radius: 1px; opacity: 0.8; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                        
                        <div class="mb-3">
                            <label for="full_name" class="form-label">–§–∞–º–∏–ª–∏—è, –∏–º—è, –æ—Ç—á–µ—Å—Ç–≤–æ <span class="text-danger">*</span></label>
                            <div class="input-group">
                            <input type="text" class="form-control" id="full_name" name="full_name" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á" required>
                                <span class="input-group-text validation-icon" id="full_name-icon">
                                    <i class="fas fa-check-circle text-success" style="display: none;"></i>
                                    <i class="fas fa-times text-danger" style="display: none;"></i>
                                </span>
                                </div>
                            <div class="form-text">–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–∏ —Ñ–∞–º–∏–ª–∏—é, –∏–º—è –∏ –æ—Ç—á–µ—Å—Ç–≤–æ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ. –ú–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞.</div>
                        </div>

                        <div class="mb-3">
                            <label for="phone" class="form-label">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ <span class="text-danger">*</span></label>
                            <div class="input-group">
                                <select class="form-select" id="phone_country" style="max-width: 120px;">
                                    <option value="+375">üáßüáæ +375</option>
                                    <option value="+7">üá∑üá∫ +7</option>
                                </select>
                                <input type="tel" class="form-control" id="phone" name="phone" placeholder="291127105" required>
                                <span class="input-group-text validation-icon" id="phone-icon">
                                    <i class="fas fa-spinner fa-spin" style="display: none;"></i>
                                    <i class="fas fa-check-circle text-success" style="display: none;"></i>
                                    <i class="fas fa-times text-danger" style="display: none;"></i>
                                </span>
                                </div>
                            <div class="form-text">–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –±–µ–∑ –∫–æ–¥–∞ —Å—Ç—Ä–∞–Ω—ã. –ü—Ä–∏–º–µ—Ä: 291234567</div>
                        </div>

                        <div class="mb-3">
                            <label for="email" class="form-label">Email <span class="text-danger">*</span></label>
                            <div class="input-group">
                            <input type="email" class="form-control" id="email" name="email" placeholder="info@liga-znatokov.by" required>
                                <span class="input-group-text validation-icon" id="email-icon">
                                    <i class="fas fa-spinner fa-spin" style="display: none;"></i>
                                    <i class="fas fa-check-circle text-success" style="display: none;"></i>
                                    <i class="fas fa-times text-danger" style="display: none;"></i>
                                </span>
                                </div>
                            <div class="form-text">–ù–∞ —ç—Ç–æ—Ç –∞–¥—Ä–µ—Å –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–∏—Å—å–º–æ —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</div>
                        </div>

                        <!-- –ü–æ–ª–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ —É—á—Ä–µ–∂–¥–µ–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è -->
                        <div class="mb-3">
                            <label for="educational_institution" class="form-label">–£—á—Ä–µ–∂–¥–µ–Ω–∏–µ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è <span class="text-danger">*</span></label>
                            <div class="input-group">
                                <input type="text" class="form-control" id="educational_institution_search" 
                                       placeholder="–°—Ä–µ–¥–Ω—è—è —à–∫–æ–ª–∞ ‚Ññ2 –≥. –ú–∏–Ω—Å–∫" autocomplete="off" required>
                                <span class="input-group-text validation-icon" id="educational_institution-icon">
                                    <i class="fas fa-check-circle text-success" style="display: none;"></i>
                                    <i class="fas fa-times text-danger" style="display: none;"></i>
                                </span>
                                </div>
                            
                            <!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è ID –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —É—á—Ä–µ–∂–¥–µ–Ω–∏—è -->
                            <input type="hidden" id="educational_institution_id" name="educational_institution_id">
                            
                            <!-- –ü–æ–ª–µ –¥–ª—è –Ω–∞–∑–≤–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ —É—á—Ä–µ–∂–¥–µ–Ω–∏—è -->
                            <input type="hidden" id="educational_institution_name" name="educational_institution_name">
                            
                            <!-- –°–ø–∏—Å–æ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞ -->
                            <div id="institution_results" class="list-group position-absolute w-100" style="z-index: 1000; display: none; max-height: 300px; overflow-y: auto; border: 1px solid #dee2e6; border-radius: 0.375rem; background: white; box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);">
                            </div>
                            
                            <style>
                                #institution_results mark {
                                    background-color: #fff3cd;
                                    color: #856404;
                                    padding: 1px 2px;
                                    border-radius: 2px;
                                    font-weight: 500;
                                }
                                
                                #institution_results .list-group-item:hover {
                                    background-color: #f8f9fa;
                                    border-color: #dee2e6;
                                }
                                
                                #institution_results .list-group-item {
                                    border-left: none;
                                    border-right: none;
                                    border-radius: 0;
                                }
                                
                                #institution_results .list-group-item:first-child {
                                    border-top-left-radius: 0.375rem;
                                    border-top-right-radius: 0.375rem;
                                }
                                
                                #institution_results .list-group-item:last-child {
                                    border-bottom-left-radius: 0.375rem;
                                    border-bottom-right-radius: 0.375rem;
                                }
                            </style>
                            
                            <div class="form-text">–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑ —Å–ø–∏—Å–∫–∞, –µ—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ - <span class="text-primary" style="cursor: pointer; text-decoration: underline;" onclick="showAddSchoolModal()">–≤–≤–µ–¥–∏—Ç–µ —Å–≤–æ—é —à–∫–æ–ª—É –∏ –¥–æ–±–∞–≤—å—Ç–µ –µ—ë –≤ –Ω–∞—à —Å–ø–∏—Å–æ–∫</span></div>
                        </div>

                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="agree_terms" name="agree_terms" required>
                            <label class="form-check-label" for="agree_terms">
                                –ú–Ω–µ —Ä–∞–∑—ä—è—Å–Ω–µ–Ω—ã –º–æ–∏ <a href="{{ url_for('rights_notification_pdf') }}" target="_blank" class="text-decoration-none">–ø—Ä–∞–≤–∞</a>, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ —è <a href="{{ url_for('teacher_consent_pdf') }}" target="_blank" class="text-decoration-none">—Å–æ–≥–ª–∞—Å–µ–Ω (–Ω–∞)</a> –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –º–æ–∏—Ö –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                            </label>
                        </div>

                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary btn-lg" id="registerButton">
                                <i class="fas fa-user-plus me-2"></i>–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –∫–∞–∫ —É—á–∏—Ç–µ–ª—å
                            </button>
                        </div>
                    </form>

                    <div class="text-center mt-3">
                        <p class="mb-0">–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a href="/login" class="text-decoration-none">–í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É</a></p>
                        <p class="mb-0">–í—ã —É—á–µ–Ω–∏–∫? <a href="/register" class="text-decoration-none">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –¥–ª—è —É—á–µ–Ω–∏–∫–æ–≤</a></p>
                    </div>
                    
                    <div class="text-center mt-4">
                        <a href="{{ url_for('cooperation') }}" class="btn btn-outline-warning cooperation-btn" style="color: #FF8C00; border-color: #FF8C00;">
                            <i class="fas fa-handshake me-2"></i>–£–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ –æ —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–µ
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –û–≤–µ—Ä–ª–µ–π –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
<div id="registerOverlay" class="loading-overlay">
    <div class="loading-spinner">
        <div class="spinner-border" role="status">
            <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
        </div>
        <p class="mt-3">–°–æ–∑–¥–∞–µ—Ç—Å—è –∞–∫–∫–∞—É–Ω—Ç —É—á–∏—Ç–µ–ª—è...</p>
        <p class="text-light small">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É</p>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π —à–∫–æ–ª—ã -->
<div class="modal fade" id="addSchoolModal" tabindex="-1" aria-labelledby="addSchoolModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addSchoolModalLabel">
                    <i class="fas fa-school me-2"></i>
                    –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —à–∫–æ–ª—É
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å"></button>
            </div>
            <div class="modal-body">
                <form id="addSchoolForm">
                    <div class="mb-3">
                        <label for="newSchoolName" class="form-label">
                            <i class="fas fa-graduation-cap me-1"></i>
                            –ü–æ–ª–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —à–∫–æ–ª—ã <span class="text-danger">*</span>
                        </label>
                        <input type="text" class="form-control" id="newSchoolName" 
                               placeholder="–°—Ä–µ–¥–Ω—è—è —à–∫–æ–ª–∞ ‚Ññ2 –≥. –ú–∏–Ω—Å–∫–∞" required>
                        <div class="form-text">–ú–∏–Ω–∏–º—É–º 5 —Å–∏–º–≤–æ–ª–æ–≤</div>
                        <div class="invalid-feedback" id="newSchoolNameError"></div>
                    </div>
                    <div class="mb-3">
                        <label for="newSchoolAddress" class="form-label">
                            <i class="fas fa-map-marker-alt me-1"></i>
                            –ê–¥—Ä–µ—Å —à–∫–æ–ª—ã <span class="text-danger">*</span>
                        </label>
                        <textarea class="form-control" id="newSchoolAddress" rows="3" 
                                  placeholder="–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ë–µ–ª–∞—Ä—É—Å—å, –ú–∏–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å, –≥. –ú–∏–Ω—Å–∫, —É–ª –°–æ–≤–µ—Ç—Å–∫–∞—è 25" required></textarea>
                        <div class="form-text">–ú–∏–Ω–∏–º—É–º 5 —Å–∏–º–≤–æ–ª–æ–≤</div>
                        <div class="invalid-feedback" id="newSchoolAddressError"></div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-1"></i>
                    –û—Ç–º–µ–Ω–∞
                </button>
                <button type="button" class="btn btn-primary" id="addSchoolBtn">
                    <i class="fas fa-plus me-1"></i>
                    –î–æ–±–∞–≤–∏—Ç—å
                </button>
            </div>
        </div>
    </div>
</div>

<style>
.loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    color: white;
}

.loading-spinner {
    text-align: center;
}

.password-requirements li {
    transition: all 0.3s ease;
}

.password-requirements li.valid {
    color: #28a745 !important;
}

.password-requirements li.valid i {
    color: #28a745 !important;
}

.password-requirements li.invalid {
    color: #dc3545 !important;
}

.password-requirements li.invalid i {
    color: #dc3545 !important;
}

.validation-icon {
    width: 40px;
    background-color: transparent !important;
    border: none !important;
}

.validation-icon i {
    font-size: 16px;
    font-weight: bold;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è */
.input-group .form-control.is-valid {
    border-color: #198754;
    border-width: 2px;
    padding-right: calc(1.5em + 0.75rem);
    background-image: none;
    box-shadow: 0 0 0 0.2rem rgba(25, 135, 84, 0.25);
    background-color: rgba(25, 135, 84, 0.05);
}

.input-group .input-group-text.is-valid {
    border-color: #198754;
    border-width: 2px;
    color: #198754;
    background-color: rgba(25, 135, 84, 0.1);
    font-weight: bold;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è */
.input-group .form-control.is-invalid {
    border-color: #dc3545;
    border-width: 2px;
    padding-right: calc(1.5em + 0.75rem);
    background-image: none;
    box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
    background-color: rgba(220, 53, 69, 0.05);
}

.input-group .input-group-text.is-invalid {
    border-color: #dc3545;
    border-width: 2px;
    color: #dc3545;
    background-color: rgba(220, 53, 69, 0.1);
    font-weight: bold;
}

/* –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è */
.input-group .form-control,
.input-group .input-group-text {
    transition: all 0.3s ease;
}

/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –¥–ª—è —Å–µ–ª–µ–∫—Ç–æ—Ä–∞ —Å—Ç—Ä–∞–Ω—ã */
.input-group .form-select.is-valid {
    border-color: #198754;
    border-width: 2px;
    box-shadow: 0 0 0 0.2rem rgba(25, 135, 84, 0.25);
    background-color: rgba(25, 135, 84, 0.05);
    background-image: none; /* –£–±–∏—Ä–∞–µ–º –≥–∞–ª–æ—á–∫—É */
}

.input-group .form-select.is-invalid {
    border-color: #dc3545;
    border-width: 2px;
    box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
    background-color: rgba(220, 53, 69, 0.05);
    background-image: none; /* –£–±–∏—Ä–∞–µ–º –∫—Ä–µ—Å—Ç–∏–∫ */
}

/* –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Å–µ–ª–µ–∫—Ç–æ—Ä–∞ —Å—Ç—Ä–∞–Ω—ã —Ç–µ–ª–µ—Ñ–æ–Ω–∞ - —É–±–∏—Ä–∞–µ–º –≥–∞–ª–æ—á–∫—É –∏ –∫—Ä–µ—Å—Ç–∏–∫ */
#phone_country.is-valid {
    background-image: none !important;
    padding-right: 0.375rem !important;
}

#phone_country.is-invalid {
    background-image: none !important;
    padding-right: 0.375rem !important;
}

.cooperation-btn:hover {
    color: #000 !important;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–¥—Å–∫–∞–∑–æ–∫ */
.tooltip-message {
    animation: fadeIn 0.3s ease-in;
    font-size: 0.875rem;
    line-height: 1.4;
    margin-top: 0.25rem;
    padding: 0.5rem;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —á–µ–∫–±–æ–∫—Å–æ–≤ —Å–æ–≥–ª–∞—Å–∏—è */
.form-check-input {
    transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
    border: 1px solid #dee2e6;
    cursor: pointer;
    animation: checkboxPulse 2s infinite;
}

.form-check-input:hover {
    border-color: #28a745;
}

.form-check-input:checked {
    background-color: #28a745;
    border-color: #28a745;
    animation: none; /* –£–±–∏—Ä–∞–µ–º –ø—É–ª—å—Å–∞—Ü–∏—é –¥–ª—è –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —á–µ–∫–±–æ–∫—Å–æ–≤ */
}

.form-check-input:focus {
    border-color: #28a745;
    box-shadow: 0 0 0 0.2rem rgba(40, 167, 69, 0.25);
}

@keyframes checkboxPulse {
    0% {
        box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.6);
    }
    70% {
        box-shadow: 0 0 0 6px rgba(40, 167, 69, 0);
    }
    100% {
        box-shadow: 0 0 0 0 rgba(40, 167, 69, 0);
    }
}

.tooltip-message.text-danger {
    background-color: rgba(220, 53, 69, 0.1);
    border-left-color: #dc3545;
    color: #dc3545;
}

.tooltip-message.text-warning {
    background-color: rgba(255, 193, 7, 0.1);
    border-left-color: #ffc107;
    color: #856404;
}

.tooltip-message i {
    margin-right: 0.5rem;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // –§—É–Ω–∫—Ü–∏–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –æ–±—ã—á–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏)
    const form = document.getElementById('teacherRegisterForm');
    const usernameField = document.getElementById('username');
    const passwordField = document.getElementById('password');
    const confirmPasswordField = document.getElementById('confirm_password');
    const fullNameField = document.getElementById('full_name');
    const phoneField = document.getElementById('phone');
    const emailField = document.getElementById('email');
    const educationalInstitutionField = document.getElementById('educational_institution_search');
    const agreeTermsField = document.getElementById('agree_terms');
    const submitButton = document.getElementById('registerButton');
    const overlay = document.getElementById('registerOverlay');

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ –ø–æ–¥—Å–∫–∞–∑–∫–∏
    function showTooltip(fieldId, message, type = 'danger') {
        const input = document.getElementById(fieldId);
        if (!input) return;
        
        // –£–¥–∞–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –ø–æ–¥—Å–∫–∞–∑–∫—É
        const existingTooltip = document.getElementById(fieldId + '-tooltip');
        if (existingTooltip) {
            existingTooltip.remove();
        }
        
        // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –ø–æ–¥—Å–∫–∞–∑–∫—É
        const tooltip = document.createElement('div');
        tooltip.id = fieldId + '-tooltip';
        tooltip.className = `tooltip-message text-${type}`;
        tooltip.innerHTML = `<i class="fas fa-info-circle"></i>${message}`;
        
        // –í—Å—Ç–∞–≤–ª—è–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É –ø–æ—Å–ª–µ –ø–æ–ª—è
        const fieldContainer = input.closest('.mb-3');
        if (fieldContainer) {
            fieldContainer.appendChild(tooltip);
        }
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –ø–æ–¥—Å–∫–∞–∑–∫–∏
    function removeTooltip(fieldId) {
        const existingTooltip = document.getElementById(fieldId + '-tooltip');
        if (existingTooltip) {
            existingTooltip.remove();
        }
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∏–ª–µ–π –ø–æ–ª—è
    function updateFieldStyles(fieldId, isValid) {
        const input = document.getElementById(fieldId);
        let iconContainer;
        
        // –û—Å–æ–±–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è –ø–æ–ª—è —É—á—Ä–µ–∂–¥–µ–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è
        if (fieldId === 'educational_institution_search') {
            iconContainer = document.querySelector('#educational_institution-icon');
        } else {
            iconContainer = document.querySelector(`#${fieldId}-icon`);
        }
        
        if (!input || !iconContainer) return;
        
        // –£–±–∏—Ä–∞–µ–º –≤—Å–µ –∫–ª–∞—Å—Å—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏
        input.classList.remove('is-valid', 'is-invalid');
        iconContainer.classList.remove('is-valid', 'is-invalid');
        
        // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è –ø–æ–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞
        if (fieldId === 'phone') {
            const phoneCountry = document.getElementById('phone_country');
            if (phoneCountry) {
                phoneCountry.classList.remove('is-valid', 'is-invalid');
                if (isValid) {
                    phoneCountry.classList.add('is-valid');
                } else if (input.value.length > 0) {
                    phoneCountry.classList.add('is-invalid');
                }
            }
        }
        
        if (isValid) {
            input.classList.add('is-valid');
            iconContainer.classList.add('is-valid');
        } else if (isValid === false) {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫—Ä–∞—Å–Ω—É—é —Ä–∞–º–∫—É –¥–ª—è –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è (–≤–∫–ª—é—á–∞—è –ø—É—Å—Ç–æ–µ –ø–æ–ª–µ)
            input.classList.add('is-invalid');
            iconContainer.classList.add('is-invalid');
        }
        // –ï—Å–ª–∏ isValid === null, —Ç–æ –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ–º –Ω–∏–∫–∞–∫–∏—Ö —Å—Ç–∏–ª–µ–π (–Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)
    }

    // –í–∞–ª–∏–¥–∞—Ü–∏—è –ª–æ–≥–∏–Ω–∞
    function validateUsername() {
        const username = usernameField.value;
        const icon = document.querySelector('#username-icon');
        const spinner = icon.querySelector('.fa-spinner');
        const check = icon.querySelector('.fa-check-circle');
        const times = icon.querySelector('.fa-times');
        
        // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –∏–∫–æ–Ω–∫–∏
        spinner.style.display = 'none';
        check.style.display = 'none';
        times.style.display = 'none';
        
        if (username.length < 3) {
            times.style.display = 'inline';
            usernameField.isValid = false;
            updateFieldStyles('username', false);
            showTooltip('username', '–õ–æ–≥–∏–Ω –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞.');
            checkFormValidity();
            return false;
        }
        
        if (!/^[a-zA-Z0-9_]+$/.test(username)) {
            times.style.display = 'inline';
            usernameField.isValid = false;
            updateFieldStyles('username', false);
            showTooltip('username', '–õ–æ–≥–∏–Ω –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ –∑–Ω–∞–∫ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è (_).');
            checkFormValidity();
            return false;
        }
        
        if (!/[a-zA-Z]/.test(username)) {
            times.style.display = 'inline';
            usernameField.isValid = false;
            updateFieldStyles('username', false);
            showTooltip('username', '–õ–æ–≥–∏–Ω –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –ª–∞—Ç–∏–Ω—Å–∫—É—é –±—É–∫–≤—É.');
            checkFormValidity();
            return false;
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –ª–æ–≥–∏–Ω–∞
        spinner.style.display = 'inline';
        
        fetch('/check-username', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({username: username, type: 'teacher'})
        })
        .then(response => response.json())
        .then(data => {
            spinner.style.display = 'none';
            if (data.available) {
                check.style.display = 'inline';
                usernameField.isValid = true;
                updateFieldStyles('username', true);
                removeTooltip('username');
            } else {
                times.style.display = 'inline';
                usernameField.isValid = false;
                updateFieldStyles('username', false);
                showTooltip('username', '–≠—Ç–æ—Ç –ª–æ–≥–∏–Ω —É–∂–µ –∑–∞–Ω—è—Ç. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ —Ü–∏—Ñ—Ä—ã/—Å–∏–º–≤–æ–ª—ã.');
            }
            checkFormValidity();
        })
        .catch(error => {
            spinner.style.display = 'none';
            times.style.display = 'inline';
            usernameField.isValid = false;
            checkFormValidity();
        });
        
        return true;
    }

    // –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–æ–ª—è
    function validatePassword() {
        const password = passwordField.value;
        const icon = document.querySelector('#password-icon');
        const check = icon.querySelector('.fa-check-circle');
        const times = icon.querySelector('.fa-times');
        
        let isValid = true;
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–ª–∏–Ω—É
        const lengthReq = document.getElementById('req-length');
        if (password.length >= 8) {
            lengthReq.classList.remove('invalid');
            lengthReq.classList.add('valid');
        } else {
            lengthReq.classList.remove('valid');
            lengthReq.classList.add('invalid');
            isValid = false;
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥–ª–∞–≤–Ω—ã–µ –±—É–∫–≤—ã
        const uppercaseReq = document.getElementById('req-uppercase');
        if (/[A-Z]/.test(password)) {
            uppercaseReq.classList.remove('invalid');
            uppercaseReq.classList.add('valid');
        } else {
            uppercaseReq.classList.remove('valid');
            uppercaseReq.classList.add('invalid');
            isValid = false;
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä–æ—á–Ω—ã–µ –±—É–∫–≤—ã
        const lowercaseReq = document.getElementById('req-lowercase');
        if (/[a-z]/.test(password)) {
            lowercaseReq.classList.remove('invalid');
            lowercaseReq.classList.add('valid');
        } else {
            lowercaseReq.classList.remove('valid');
            lowercaseReq.classList.add('invalid');
            isValid = false;
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ü–∏—Ñ—Ä—ã
        const numberReq = document.getElementById('req-number');
        if (/[0-9]/.test(password)) {
            numberReq.classList.remove('invalid');
            numberReq.classList.add('valid');
        } else {
            numberReq.classList.remove('valid');
            numberReq.classList.add('invalid');
            isValid = false;
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã
        const specialReq = document.getElementById('req-special');
        if (/[!@#$%^&*()_+\-=\[\]{}|;:,.<>?]/.test(password)) {
            specialReq.classList.remove('invalid');
            specialReq.classList.add('valid');
        } else {
            specialReq.classList.remove('valid');
            specialReq.classList.add('invalid');
            isValid = false;
        }
        
        check.style.display = 'none';
        times.style.display = 'none';
        
        if (password.length > 0) {
                    if (isValid) {
            check.style.display = 'inline';
            updateFieldStyles('password', true);
        } else {
            times.style.display = 'inline';
            updateFieldStyles('password', false);
        }
        }
        
        passwordField.isValid = isValid;
        validateConfirmPassword(); // –ü–µ—Ä–µ–ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è
        return isValid;
    }
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è
    function validateConfirmPassword() {
        const password = passwordField.value;
        const confirmPassword = confirmPasswordField.value;
        const icon = document.querySelector('#confirm_password-icon');
        const check = icon.querySelector('.fa-check-circle');
        const times = icon.querySelector('.fa-times');
        
        check.style.display = 'none';
        times.style.display = 'none';
        
        if (confirmPassword.length > 0) {
            if (password === confirmPassword && passwordField.isValid) {
                check.style.display = 'inline';
                confirmPasswordField.isValid = true;
                updateFieldStyles('confirm_password', true);
            } else {
                times.style.display = 'inline';
                confirmPasswordField.isValid = false;
                updateFieldStyles('confirm_password', false);
            }
        } else {
            confirmPasswordField.isValid = false;
            updateFieldStyles('confirm_password', null);
        }
        
        return confirmPasswordField.isValid;
    }

    // –í–∞–ª–∏–¥–∞—Ü–∏—è –§–ò–û
    function validateFullName() {
        const fullName = fullNameField.value;
        const icon = document.querySelector('#full_name-icon');
        const check = icon.querySelector('.fa-check-circle');
        const times = icon.querySelector('.fa-times');
        
        check.style.display = 'none';
        times.style.display = 'none';
        
        if (fullName.length >= 2 && fullName.length <= 100 && /^[–∞-—è—ë–ê-–Ø–Åa-zA-Z\s\-\.]+$/.test(fullName)) {
            check.style.display = 'inline';
            fullNameField.isValid = true;
            updateFieldStyles('full_name', true);
        } else if (fullName.length > 0) {
            times.style.display = 'inline';
            fullNameField.isValid = false;
            updateFieldStyles('full_name', false);
        } else {
            fullNameField.isValid = false;
            updateFieldStyles('full_name', null);
        }
        
        return fullNameField.isValid;
    }

    // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞
    function validatePhone() {
        const phone = phoneField.value;
        const phoneCountry = document.getElementById('phone_country').value;
        const icon = document.querySelector('#phone-icon');
        const spinner = icon.querySelector('.fa-spinner');
        const check = icon.querySelector('.fa-check-circle');
        const times = icon.querySelector('.fa-times');
        
        spinner.style.display = 'none';
        check.style.display = 'none';
        times.style.display = 'none';
        
        let isValid = false;
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤–≤–µ–¥–µ–Ω—ã —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã
        if (!/^[0-9]+$/.test(phone)) {
            isValid = false;
        } else if (phoneCountry === '+375' && /^[0-9]{9}$/.test(phone)) {
            isValid = true;
        } else if (phoneCountry === '+7' && /^[0-9]{10}$/.test(phone)) {
            isValid = true;
        }
        
        if (!isValid) {
            if (phone.length > 0) {
                times.style.display = 'inline';
                updateFieldStyles('phone', false);
            }
            phoneField.isValid = false;
            checkFormValidity();
            return false;
        }
        
        // –ï—Å–ª–∏ –ø–æ–ª–µ –ø—É—Å—Ç–æ–µ –∏–ª–∏ —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–æ–µ, –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å
        if (!phone || phone.trim() === '' || phone.length < 9) {
            phoneField.isValid = false;
            updateFieldStyles('phone', null);
            checkFormValidity();
            return false;
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω–∞
        const fullPhone = phoneCountry + phone;
        spinner.style.display = 'inline';
        
        fetch('/check-phone', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({phone: fullPhone, type: 'teacher'})
        })
        .then(async response => {
            if (response.status === 429) {
                const retryAfter = response.headers.get('Retry-After');
                const waitMsg = retryAfter ? `–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–æ–ø—ã—Ç–∫—É —á–µ—Ä–µ–∑ ${retryAfter} —Å–µ–∫—É–Ω–¥` : '–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–æ–ø—ã—Ç–∫—É —á—É—Ç—å –ø–æ–∑–∂–µ';
                spinner.style.display = 'none';
                times.style.display = 'inline';
                phoneField.isValid = false;
                updateFieldStyles('phone', false);
                console.warn('–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫ —Ç–µ–ª–µ—Ñ–æ–Ω–∞. ' + waitMsg);
                if (typeof showNotification === 'function') {
                    showNotification('–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–æ–ø—ã—Ç–æ–∫', waitMsg, 'warning');
                }
                return { available: false };
            }
            return response.json();
        })
        .then(data => {
            spinner.style.display = 'none';
            if (data.available) {
                check.style.display = 'inline';
                phoneField.isValid = true;
                updateFieldStyles('phone', true);
                removeTooltip('phone');
            } else {
                times.style.display = 'inline';
                phoneField.isValid = false;
                updateFieldStyles('phone', false);
                showTooltip('phone', '–≠—Ç–æ—Ç –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –Ω–æ–º–µ—Ä –∏–ª–∏ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É.');
            }
            checkFormValidity();
        })
        .catch(error => {
            spinner.style.display = 'none';
            times.style.display = 'inline';
            phoneField.isValid = false;
            updateFieldStyles('phone', false);
            checkFormValidity();
        });
        
        return true;
    }

    // –í–∞–ª–∏–¥–∞—Ü–∏—è email
    function validateEmail() {
        const email = emailField.value;
        const icon = document.querySelector('#email-icon');
        const spinner = icon.querySelector('.fa-spinner');
        const check = icon.querySelector('.fa-check-circle');
        const times = icon.querySelector('.fa-times');
        
        spinner.style.display = 'none';
        check.style.display = 'none';
        times.style.display = 'none';
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ —Ä—É—Å—Å–∫–∏–µ —Å–∏–º–≤–æ–ª—ã
        const russianRegex = /[–∞-—è—ë–ê-–Ø–Å]/;
        if (russianRegex.test(email)) {
            times.style.display = 'inline';
            emailField.isValid = false;
            showTooltip('email', 'Email –Ω–µ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ä—É—Å—Å–∫–∏–µ —Å–∏–º–≤–æ–ª—ã. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã.');
            checkFormValidity();
            return false;
        }
        
        if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
            if (email.length > 0) {
                times.style.display = 'inline';
            }
            emailField.isValid = false;
            removeTooltip('email');
            return false;
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å email
        spinner.style.display = 'inline';
        
        // –î–µ–±–∞—É–Ω—Å –∏ —á–∞—Å—Ç–æ—Ç–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ —É–∂–µ –µ—Å—Ç—å; –ø—Ä–æ—Å—Ç–æ –æ–±—Ä–∞—â–∞–µ–º—Å—è –∫ API
        fetch('/check-email', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({email: email, type: 'teacher'})
        })
        .then(async response => {
            if (response.status === 429) {
                const retryAfter = response.headers.get('Retry-After');
                const waitMsg = retryAfter ? `–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–æ–ø—ã—Ç–∫—É —á–µ—Ä–µ–∑ ${retryAfter} —Å–µ–∫—É–Ω–¥` : '–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–æ–ø—ã—Ç–∫—É —á—É—Ç—å –ø–æ–∑–∂–µ';
                spinner.style.display = 'none';
                times.style.display = 'inline';
                emailField.isValid = false;
                console.warn('–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫ email. ' + waitMsg);
                if (typeof showNotification === 'function') {
                    showNotification('–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–æ–ø—ã—Ç–æ–∫', waitMsg, 'warning');
                }
                return { available: false };
            }
            return response.json();
        })
        .then(data => {
            spinner.style.display = 'none';
            if (data.available) {
                check.style.display = 'inline';
                emailField.isValid = true;
                updateFieldStyles('email', true);
                removeTooltip('email');
            } else {
                times.style.display = 'inline';
                emailField.isValid = false;
                updateFieldStyles('email', false);
                showTooltip('email', '–≠—Ç–æ—Ç email —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –∞–¥—Ä–µ—Å –∏–ª–∏ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É.');
            }
            checkFormValidity();
        })
        .catch(error => {
            spinner.style.display = 'none';
            times.style.display = 'inline';
            emailField.isValid = false;
            checkFormValidity();
        });
        
        return true;
    }

    // –í–∞–ª–∏–¥–∞—Ü–∏—è —É—á—Ä–µ–∂–¥–µ–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è
    function validateEducationalInstitution() {
        const searchValue = educationalInstitutionField.value.trim();
        const institutionIdField = document.getElementById('educational_institution_id');
        const institutionNameField = document.getElementById('educational_institution_name');
        const icon = document.querySelector('#educational_institution-icon');
        const check = icon.querySelector('.fa-check-circle');
        const times = icon.querySelector('.fa-times');
        
        // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –∏–∫–æ–Ω–∫–∏
        check.style.display = 'none';
        times.style.display = 'none';
        
        const hasId = institutionIdField.value.trim() !== '';
        const hasName = institutionNameField.value.trim() !== '';
        
        // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–µ–ª —Ç–µ–∫—Å—Ç, –Ω–æ –Ω–µ –≤—ã–±—Ä–∞–ª –∏–∑ —Å–ø–∏—Å–∫–∞ –∏ –Ω–µ –Ω–∞–∂–∞–ª "–°–æ–∑–¥–∞—Ç—å",
        // –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—á–∏—Ç–∞–µ–º —ç—Ç–æ –Ω–æ–≤—ã–º —É—á—Ä–µ–∂–¥–µ–Ω–∏–µ–º
        if (searchValue.length >= 2 && !hasId && !hasName) {
            institutionNameField.value = searchValue;
        }
        
        // –ü–æ–ª–µ –≤–∞–ª–∏–¥–Ω–æ, –µ—Å–ª–∏ –µ—Å—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –ø–æ–∏—Å–∫–µ –ò (–µ—Å—Ç—å ID –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —É—á—Ä–µ–∂–¥–µ–Ω–∏—è –ò–õ–ò –µ—Å—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —É—á—Ä–µ–∂–¥–µ–Ω–∏—è)
        const isValid = searchValue.length >= 2 && (hasId || institutionNameField.value.trim() !== '');
        
        if (isValid) {
            check.style.display = 'inline';
            educationalInstitutionField.isValid = true;
            updateFieldStyles('educational_institution_search', true);
        } else if (searchValue.length > 0) {
            // –ï—Å—Ç—å —Ç–µ–∫—Å—Ç, –Ω–æ –æ–Ω –Ω–µ–≤–∞–ª–∏–¥–µ–Ω (–º–µ–Ω–µ–µ 2 —Å–∏–º–≤–æ–ª–æ–≤)
            times.style.display = 'inline';
            educationalInstitutionField.isValid = false;
            updateFieldStyles('educational_institution_search', false);
        } else {
            // –ü–æ–ª–µ –ø—É—Å—Ç–æ–µ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫—Ä–∞—Å–Ω—É—é —Ä–∞–º–∫—É –∏ –∫—Ä–µ—Å—Ç–∏–∫
            times.style.display = 'inline';
            educationalInstitutionField.isValid = false;
            updateFieldStyles('educational_institution_search', false);
        }
        
        checkFormValidity();
        return educationalInstitutionField.isValid;
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—â–µ–π –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ —Ñ–æ—Ä–º—ã
    function checkFormValidity() {
        const isValid = usernameField.isValid && 
                       passwordField.isValid && 
                       confirmPasswordField.isValid && 
                       fullNameField.isValid && 
                       phoneField.isValid && 
                       emailField.isValid && 
                       educationalInstitutionField.isValid && 
                       agreeTermsField.checked;
        
        submitButton.disabled = !isValid;
        
        if (isValid) {
            submitButton.classList.remove('btn-secondary');
            submitButton.classList.add('btn-primary');
        } else {
            submitButton.classList.remove('btn-primary');
            submitButton.classList.add('btn-secondary');
        }
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
    usernameField.addEventListener('input', function() {
        removeTooltip('username');
        validateUsername();
    });
    passwordField.addEventListener('input', validatePassword);
    confirmPasswordField.addEventListener('input', validateConfirmPassword);
    fullNameField.addEventListener('input', validateFullName);
    
    // –î–µ–±–∞—É–Ω—Å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
    let phoneTimeout;
    phoneField.addEventListener('input', function() {
        clearTimeout(phoneTimeout);
        
        // –ï—Å–ª–∏ –ø–æ–ª–µ –ø—É—Å—Ç–æ–µ, —Å—Ä–∞–∑—É —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
        if (!this.value || this.value.trim() === '') {
            const icon = document.querySelector('#phone-icon');
            const spinner = icon.querySelector('.fa-spinner');
            const check = icon.querySelector('.fa-check-circle');
            const times = icon.querySelector('.fa-times');
            
            spinner.style.display = 'none';
            check.style.display = 'none';
            times.style.display = 'none';
            
            phoneField.isValid = false;
            removeTooltip('phone');
            checkFormValidity();
            return;
        }
        
        phoneTimeout = setTimeout(() => {
            validatePhone();
        }, 500);
    });
    
    emailField.addEventListener('input', function() {
        removeTooltip('email');
        validateEmail();
    });
    educationalInstitutionField.addEventListener('input', validateEducationalInstitution);
    agreeTermsField.addEventListener('change', function() {
        checkFormValidity();
    });
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞ —Å—Ç—Ä–∞–Ω—ã –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞
    document.getElementById('phone_country').addEventListener('change', function() {
        updatePhonePlaceholder();
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–¥–∞ —Å—Ç—Ä–∞–Ω—ã
        const icon = document.querySelector('#phone-icon');
        const spinner = icon.querySelector('.fa-spinner');
        const check = icon.querySelector('.fa-check-circle');
        const times = icon.querySelector('.fa-times');
        
        spinner.style.display = 'none';
        check.style.display = 'none';
        times.style.display = 'none';
        
        phoneField.isValid = false;
        checkFormValidity();
        
        // –ï—Å–ª–∏ –≤ –ø–æ–ª–µ –µ—Å—Ç—å –Ω–æ–º–µ—Ä, –ø—Ä–æ–≤–µ—Ä—è–µ–º –µ–≥–æ —Å –Ω–æ–≤—ã–º –∫–æ–¥–æ–º —Å—Ç—Ä–∞–Ω—ã
        if (phoneField.value.trim() !== '') {
            validatePhone();
        }
    });
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–∞ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
    function updatePhonePlaceholder() {
        const countryCode = document.getElementById('phone_country').value;
        const phoneInput = document.getElementById('phone');
        
        if (countryCode === '+375') {
            // –ë–µ–ª–∞—Ä—É—Å—å: 9 —Ü–∏—Ñ—Ä –ø–æ—Å–ª–µ –∫–æ–¥–∞
            phoneInput.placeholder = '291127105';
        } else if (countryCode === '+7') {
            // –†–æ—Å—Å–∏—è: 10 —Ü–∏—Ñ—Ä –ø–æ—Å–ª–µ –∫–æ–¥–∞
            phoneInput.placeholder = '9101130533';
        }
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    updatePhonePlaceholder();
    
    // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –ø–∞—Ä–æ–ª—å
    document.getElementById('togglePassword').addEventListener('click', function() {
        const passwordField = document.getElementById('password');
        const icon = this.querySelector('i');
        
        if (passwordField.type === 'password') {
            passwordField.type = 'text';
            icon.classList.remove('fa-eye');
            icon.classList.add('fa-eye-slash');
        } else {
            passwordField.type = 'password';
            icon.classList.remove('fa-eye-slash');
            icon.classList.add('fa-eye');
        }
    });

    document.getElementById('toggleConfirmPassword').addEventListener('click', function() {
        const confirmPasswordField = document.getElementById('confirm_password');
        const icon = this.querySelector('i');
        
        if (confirmPasswordField.type === 'password') {
            confirmPasswordField.type = 'text';
            icon.classList.remove('fa-eye');
            icon.classList.add('fa-eye-slash');
        } else {
            confirmPasswordField.type = 'password';
            icon.classList.remove('fa-eye-slash');
            icon.classList.add('fa-eye');
        }
    });

    // –ê–≤—Ç–æ–∫–æ–º–ø–ª–∏—Ç –¥–ª—è —É—á–µ–±–Ω—ã—Ö –∑–∞–≤–µ–¥–µ–Ω–∏–π
    const searchField = document.getElementById('educational_institution_search');
    const resultsContainer = document.getElementById('institution_results');
    const institutionIdField = document.getElementById('educational_institution_id');
    const institutionNameField = document.getElementById('educational_institution_name');
    
    // === –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –î–õ–Ø –î–û–ë–ê–í–õ–ï–ù–ò–Ø –®–ö–û–õ–´ ===
    const addSchoolModal = new bootstrap.Modal(document.getElementById('addSchoolModal'));
    const newSchoolNameInput = document.getElementById('newSchoolName');
    const newSchoolAddressInput = document.getElementById('newSchoolAddress');
    const addSchoolBtn = document.getElementById('addSchoolBtn');
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —à–∫–æ–ª—ã
    function showAddSchoolModal() {
        // –û—á–∏—â–∞–µ–º –ø–æ–ª—è
        newSchoolNameInput.value = '';
        newSchoolAddressInput.value = '';
        
        // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏
        newSchoolNameInput.classList.remove('is-valid', 'is-invalid');
        newSchoolAddressInput.classList.remove('is-valid', 'is-invalid');
        
        // –°–∫—Ä—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
        document.getElementById('newSchoolNameError').textContent = '';
        document.getElementById('newSchoolAddressError').textContent = '';
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        addSchoolModal.show();
    }
    
    // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –≥–ª–æ–±–∞–ª—å–Ω–æ–π –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ onclick
    window.showAddSchoolModal = showAddSchoolModal;
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–æ–ª–µ–π –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
    function validateModalFields() {
        const name = newSchoolNameInput.value.trim();
        const address = newSchoolAddressInput.value.trim();
        
        let isValid = true;
        
        // –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞–∑–≤–∞–Ω–∏—è
        if (name.length < 5) {
            newSchoolNameInput.classList.add('is-invalid');
            newSchoolNameInput.classList.remove('is-valid');
            document.getElementById('newSchoolNameError').textContent = '–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 5 —Å–∏–º–≤–æ–ª–æ–≤';
            isValid = false;
        } else {
            newSchoolNameInput.classList.add('is-valid');
            newSchoolNameInput.classList.remove('is-invalid');
            document.getElementById('newSchoolNameError').textContent = '';
        }
        
        // –í–∞–ª–∏–¥–∞—Ü–∏—è –∞–¥—Ä–µ—Å–∞
        if (address.length < 5) {
            newSchoolAddressInput.classList.add('is-invalid');
            newSchoolAddressInput.classList.remove('is-valid');
            document.getElementById('newSchoolAddressError').textContent = '–ê–¥—Ä–µ—Å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 5 —Å–∏–º–≤–æ–ª–æ–≤';
            isValid = false;
        } else {
            newSchoolAddressInput.classList.add('is-valid');
            newSchoolAddressInput.classList.remove('is-invalid');
            document.getElementById('newSchoolAddressError').textContent = '';
        }
        
        return isValid;
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –ø–æ–ª–µ–π –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    newSchoolNameInput.addEventListener('input', validateModalFields);
    newSchoolAddressInput.addEventListener('input', validateModalFields);
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–î–æ–±–∞–≤–∏—Ç—å"
    addSchoolBtn.addEventListener('click', function() {
        if (!validateModalFields()) {
            return;
        }
        
        const name = newSchoolNameInput.value.trim();
        const address = newSchoolAddressInput.value.trim();
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
        addSchoolBtn.disabled = true;
        addSchoolBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ...';
        
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        fetch('/api/add-educational-institution', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                name: name,
                address: address
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                addSchoolModal.hide();
                
                // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞ –Ω–æ–≤–æ–π —à–∫–æ–ª–æ–π
                searchField.value = name;
                institutionIdField.value = data.institution_id;
                institutionNameField.value = '';
                
                // –í–∞–ª–∏–¥–∏—Ä—É–µ–º —Ñ–æ—Ä–º—É
                validateEducationalInstitution();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
                if (typeof showNotification === 'function') {
                    showNotification('–£—Å–ø–µ—à–Ω–æ!', '–®–∫–æ–ª–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ —Å–ø–∏—Å–æ–∫', 'success');
                }
            } else {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É
                if (data.error) {
                    if (typeof showNotification === 'function') {
                        showNotification('–û—à–∏–±–∫–∞', data.error, 'error');
                    }
                }
            }
        })
        .catch(error => {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —à–∫–æ–ª—ã:', error);
            if (typeof showNotification === 'function') {
                showNotification('–û—à–∏–±–∫–∞', '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —à–∫–æ–ª—ã', 'error');
            }
        })
        .finally(() => {
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
            addSchoolBtn.disabled = false;
            addSchoolBtn.innerHTML = '<i class="fas fa-plus me-1"></i>–î–æ–±–∞–≤–∏—Ç—å';
        });
    });
    
    let searchTimeout;
    
    searchField.addEventListener('input', function() {
        const query = this.value.trim();
        
        clearTimeout(searchTimeout);
        
        if (query.length < 2) {
            resultsContainer.style.display = 'none';
            institutionIdField.value = '';
            institutionNameField.value = '';
            return;
        }
        
        searchTimeout = setTimeout(() => {
            fetch(`/api/search-educational-institutions?q=${encodeURIComponent(query)}`)
                .then(response => response.json())
                .then(data => {
                    resultsContainer.innerHTML = '';
                    
                    if (data.institutions.length > 0) {
                        // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É "–î–æ–±–∞–≤–∏—Ç—å —Å–≤–æ—é —à–∫–æ–ª—É" –≤ –Ω–∞—á–∞–ª–æ —Å–ø–∏—Å–∫–∞
                        const addSchoolItem = document.createElement('button');
                        addSchoolItem.type = 'button';
                        addSchoolItem.className = 'list-group-item list-group-item-action text-primary border-bottom';
                        addSchoolItem.innerHTML = `
                            <div class="text-center">
                                <i class="fas fa-plus me-2"></i>
                                <strong>–î–æ–±–∞–≤–∏—Ç—å —Å–≤–æ—é —à–∫–æ–ª—É</strong>
                            </div>
                        `;
                        
                        addSchoolItem.addEventListener('click', function() {
                            resultsContainer.style.display = 'none';
                            showAddSchoolModal();
                        });
                        
                        resultsContainer.appendChild(addSchoolItem);
                        
                        data.institutions.forEach(institution => {
                            const item = document.createElement('button');
                            item.type = 'button';
                            item.className = 'list-group-item list-group-item-action d-flex flex-column align-items-start';
                            
                            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–¥—Å–≤–µ—á–µ–Ω–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ
                            const displayName = institution.highlighted_name || institution.name;
                            
                            item.innerHTML = `
                                <div class="d-flex w-100 justify-content-between">
                                    <h6 class="mb-1 text-start">${displayName}</h6>
                                    <small class="text-muted">
                                        <i class="fas fa-map-marker-alt"></i>
                                    </small>
                                </div>
                                <p class="mb-0 text-muted small text-start">${institution.address}</p>
                            `;
                            
                            // –î–æ–±–∞–≤–ª—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç –Ω–∞–≤–µ–¥–µ–Ω–∏—è
                            item.addEventListener('mouseenter', function() {
                                this.style.backgroundColor = '#f8f9fa';
                            });
                            
                            item.addEventListener('mouseleave', function() {
                                this.style.backgroundColor = '';
                            });
                            
                            item.addEventListener('click', function() {
                                searchField.value = institution.name;
                                institutionIdField.value = institution.id;
                                institutionNameField.value = '';
                                resultsContainer.style.display = 'none';
                                validateEducationalInstitution();
                            });
                            
                            resultsContainer.appendChild(item);
                        });
                        
                        resultsContainer.style.display = 'block';
                    } else {
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–î–æ–±–∞–≤–∏—Ç—å —Å–≤–æ—é —à–∫–æ–ª—É" –∫–æ–≥–¥–∞ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
                        const addSchoolItem = document.createElement('button');
                        addSchoolItem.type = 'button';
                        addSchoolItem.className = 'list-group-item list-group-item-action text-primary';
                        addSchoolItem.innerHTML = `
                            <div class="text-center">
                                <i class="fas fa-plus me-2"></i>
                                <strong>–î–æ–±–∞–≤–∏—Ç—å —Å–≤–æ—é —à–∫–æ–ª—É</strong>
                            </div>
                        `;
                        
                        addSchoolItem.addEventListener('click', function() {
                            resultsContainer.style.display = 'none';
                            showAddSchoolModal();
                        });
                        
                        resultsContainer.appendChild(addSchoolItem);
                        resultsContainer.style.display = 'block';
                    }
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞:', error);
                    resultsContainer.style.display = 'none';
                });
        }, 300);
    });

    // –°–∫—Ä—ã—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –æ–±–ª–∞—Å—Ç–∏
    document.addEventListener('click', function(e) {
        if (!searchField.contains(e.target) && !resultsContainer.contains(e.target)) {
            resultsContainer.style.display = 'none';
        }
    });

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        if (!submitButton.disabled) {
            overlay.style.display = 'flex';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–¥ —Å—Ç—Ä–∞–Ω—ã –∫ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞
            const phoneCountry = document.getElementById('phone_country').value;
            const phoneNumber = phoneField.value;
            const fullPhone = phoneCountry + phoneNumber;
            
            // –°–æ–∑–¥–∞–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
            const hiddenPhoneField = document.createElement('input');
            hiddenPhoneField.type = 'hidden';
            hiddenPhoneField.name = 'phone_country';
            hiddenPhoneField.value = phoneCountry;
            form.appendChild(hiddenPhoneField);
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–æ—Ä–º—É
            form.submit();
        }
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ –ø–æ–ª–µ–π
    usernameField.isValid = false;
    passwordField.isValid = false;
    confirmPasswordField.isValid = false;
    fullNameField.isValid = false;
    phoneField.isValid = false;
    emailField.isValid = false;
    educationalInstitutionField.isValid = false;
    
    checkFormValidity();

    // === –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ü–û–î–°–í–ï–¢–ö–ò –ü–£–°–¢–´–• –ü–û–õ–ï–ô ===
    function highlightEmptyFields() {
        const requiredFields = [
            'username', 'password', 'confirm_password', 'full_name', 
            'phone', 'email', 'educational_institution_search'
        ];
        
        requiredFields.forEach(fieldId => {
            const field = document.getElementById(fieldId);
            let iconContainer;
            
            // –û—Å–æ–±–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è –ø–æ–ª—è —É—á—Ä–µ–∂–¥–µ–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è
            if (fieldId === 'educational_institution_search') {
                iconContainer = document.getElementById('educational_institution-icon');
            } else {
                iconContainer = document.getElementById(fieldId + '-icon');
            }
            
            if (field) {
                let isEmpty = field.value.trim() === '';
                
                // –û—Å–æ–±–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è –ø–æ–ª—è —É—á—Ä–µ–∂–¥–µ–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è
                if (fieldId === 'educational_institution_search') {
                    // –ü–æ–ª–µ —Å—á–∏—Ç–∞–µ—Ç—Å—è –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º, –µ—Å–ª–∏ –≤ –Ω–µ–º –µ—Å—Ç—å —Ö–æ—Ç—è –±—ã 2 —Å–∏–º–≤–æ–ª–∞
                    isEmpty = field.value.trim().length < 2;
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Å—Ç–∏–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (–∫—Ä–∞—Å–Ω–∞—è –∏–ª–∏ –∑–µ–ª–µ–Ω–∞—è —Ä–∞–º–∫–∞)
                const hasValidationStyles = field.classList.contains('is-valid') || field.classList.contains('is-invalid');
                
                if (isEmpty && !hasValidationStyles) {
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–µ—Ä—Ü–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ—Ç —Å—Ç–∏–ª–µ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏
                    field.classList.add('empty-field');
                    if (iconContainer) {
                        iconContainer.classList.add('empty-field');
                    }
                } else {
                    // –£–±–∏—Ä–∞–µ–º –º–µ—Ä—Ü–∞–Ω–∏–µ
                    field.classList.remove('empty-field');
                    if (iconContainer) {
                        iconContainer.classList.remove('empty-field');
                    }
                }
            }
        });
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á–µ–∫–±–æ–∫—Å—ã
        const agreeCheckbox = document.getElementById('agree');
        const agreeTermsCheckbox = document.getElementById('agree_terms');
        
        if (agreeCheckbox && !agreeCheckbox.checked) {
            agreeCheckbox.parentElement.classList.add('empty-field');
        } else if (agreeCheckbox) {
            agreeCheckbox.parentElement.classList.remove('empty-field');
        }
        
        if (agreeTermsCheckbox && !agreeTermsCheckbox.checked) {
            agreeTermsCheckbox.parentElement.classList.add('empty-field');
        } else if (agreeTermsCheckbox) {
            agreeTermsCheckbox.parentElement.classList.remove('empty-field');
        }
    }

    // –ó–∞–ø—É—Å–∫–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É –ø—É—Å—Ç—ã—Ö –ø–æ–ª–µ–π –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã
    setInterval(highlightEmptyFields, 3000);
    
    // –¢–∞–∫–∂–µ –∑–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    setTimeout(highlightEmptyFields, 1000);
});
</script>
{% endblock %} 
